- A contact must have at least one entry in its 'names' OR one entry in its 'emails'

- search frontend features
  - esc and losing focus closes results
  - clicking a tag name starts a search for that tab
  - arrow keys move between results
  - clicking (or pressing enter if using arrow keys)
- search backend features
  - multiple terms, space delimited
  - prefix search term with type (eg., 'tag:')
  - no duplicates in results

- lots of bindings stuff only SEEMS to work because the model data happens to be loaded already. Notable places this happens are the activity
  feed implicitly loading a few contacts and the search box loading many more
- you must use an object, not an id, when making a belongsTo relationship
- ember-data store serializes all camel case model attributes to underscored ones and tries to append '_id' to belongsTo relationship names if you don't specify a key



Needed Features (ember/angular/knockout/derby research):
  - speedy loading with browser push/pop states (ideally only refreshing parts of the page that it has to), or more generally avoiding roundtrips to the server
  - bindings(auto-updating) in the view template
  - auto-persistance of view bindgings into a database
  - which is more appropriate for a "one-page" web application. While we won't always be making one-page web apps, the principles involved in making one (lots of rendering and route-handling on the client-side, etc) are great to have available
    - template composition
  - the ability to respond to events (user/dom events of course, also know when a PARTICULAR MODEL is changed so I can respond. Derby didn't allow this and it made using js plugins difficult)
  - realtime between clients of the app via bindings (probably can't get this without derby)
  - the ability to use any templating engine





--------------------------------- xoath attempts ---------------------------------

user =
	id: '178'
	email: 'kbaranowski@redstar.com'
	oauth:
		token: '1/yypfkV2FmS_2BHEomTHYiYPFWr9Mv7SP7_Iip95Nph8',
		secret: 'UOhGFM77U1PJOkwKIy-cF4EO'
	last_parse_date: null





# nodemailer = require 'nodemailer'

# generator = nodemailer.createXOAuthGenerator
# 	user: user.email
# 	token: user.oauth.token
# 	tokenSecret: user.oauth.secret
# xoauth = generator.generate()

oauth = require 'oauth-gmail'
client = oauth.createClient callbackUrl: 'http://' + process.env.HOST + '/authorized'
xoauth = client.xoauthString user.email, user.oauth.token, user.oauth.secret

# XOauth = require 'gmail-xoauth'
# asdf = new XOauth 'anonymous', 'anonymous'
# xoauth = asdf.generateIMAPXOauthString user.email, user.oauth.token, user.oauth.secret

# console.log xoauth


# xoauth = 'R0VUIGh0dHBzOi8vbWFpbC5nb29nbGUuY29tL21haWwvYi9rYmFyYW5vd3NraUByZWRzdGFyLmNvbS9pbWFwLyBvYXV0aF9jb25zdW1lcl9rZXk9ImFub255bW91cyIsb2F1dGhfbm9uY2U9IjEzMTI2NTYwNzIyNjcxMTczMDA5IixvYXV0aF9zaWduYXR1cmU9ImViMFYlMkZyRU02TWJSSExmOWhMVENMM3R4djg4JTNEIixvYXV0aF9zaWduYXR1cmVfbWV0aG9kPSJITUFDLVNIQTEiLG9hdXRoX3RpbWVzdGFtcD0iMTM0NTc0NzAzMSIsb2F1dGhfdG9rZW49IjElMkZ5eXBma1YyRm1TXzJCSEVvbVRIWWlZUEZXcjlNdjdTUDdfSWlwOTVOcGg4IixvYXV0aF92ZXJzaW9uPSIxLjAi'

console.log xoauth

imap = require 'imap'
server = new imap.ImapConnection
	xoauth: xoauth
	host: 'imap.gmail.com'
	port: 993
	secure: true

server.connect (err) ->
	throw err if err
	server.openBox '[Gmail]/All Mail', true, (err, box) ->
		throw err if err

		criteria = [['FROM', 'annie@redstar.com']]
		if previous = user.last_parse_date
			criteria.unshift ['SINCE', previous]
		server.search criteria, (err, results) ->
			throw err if err
			mimelib = require 'mimelib'
			contacts = {}

			# notifications.foundTotal results.length
			console.log results.length

